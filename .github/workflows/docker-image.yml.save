name: Docker Image CI

on:
  push:
    branches: [ "dev", "master", feat/ci ]
  pull_request:
    branches: [ "dev", "master" ]

jobs:
  build:
    name: Build project
    runs-on: ubuntu-latest

    steps:
      name: Checkout repository
      uses: actions/checkout@v4
      
      name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: 20

      name: install packages
      run: pnpm install --frozen-lockfile

      name: build
      run: pnpm build

      name: delete packages for not prod version
      run: pnpm prune --prod

  
  deploy:
    name: Deploy project
    runs-on: ubuntu-latest


    needs: build
    
    steps:
      name: Checkout repository
      uses: actions/checkout@v4

      name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: 20

      name: start application 
      run: node dist/main.js
